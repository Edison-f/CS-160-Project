<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Resources — SortSmart</title>
    <meta property="og:title" content="Resources — SortSmart" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta property="twitter:card" content="summary_large_image" />
    <link rel="stylesheet" href="./style.css" />
    <link href="./index.css" rel="stylesheet" />
    <style>
        .home-container1 {
          min-height: auto;
        }
        /* Ensure header/nav text is not underlined before hover on this page */
        .navigation__container a,
        .navigation__link,
        .navigation__logo,
        .navigation__logo-text {
          text-decoration: none !important;
        }
        /* Page header (H1/H2) should never be underlined */
        .resources-content h1,
        .resources-content h2 {
          text-decoration: none;
        }
    </style>
  </head>
  <body>
    <div>
      <div class="home-container1">
        <navigation-wrapper class="navigation-wrapper">
          <div class="navigation-container1">
            <nav id="main-navigation" aria-label="Main navigation" class="navigation">
              <div class="navigation__container">
                <a href="index.html">
                  <div aria-label="SortSmart - Home" class="navigation__logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                         viewBox="0 0 24 24" aria-hidden="true" class="navigation__logo-icon">
                      <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                        <path d="M7 19H4.815a1.83 1.83 0 0 1-1.57-.881a1.79 1.79 0 0 1-.004-1.784L7.196 9.5M11 19h8.203a1.83 1.83 0 0 0 1.556-.89a1.78 1.78 0 0 0 0-1.775l-1.226-2.12"></path>
                        <path d="m14 16l-3 3l3 3m-5.707-8.404L7.196 9.5L3.1 10.598m6.244-4.787l1.093-1.892A1.83 1.83 0 0 1 11.985 3a1.78 1.78 0 0 1 1.546.888l3.943 6.843"></path>
                        <path d="m13.378 9.633l4.096 1.098l1.097-4.096"></path>
                      </g>
                    </svg>
                    <span class="navigation__logo-text">SortSmart</span>
                  </div>
                </a>
                <button
                  id="navigation-toggle"
                  aria-expanded="false"
                  aria-controls="navigation-menu"
                  aria-label="Toggle navigation menu"
                  class="navigation__toggle"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    class="navigation-navigationtoggle-icon1 navigation__toggle-icon--open"
                  >
                    <path
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 5h16M4 12h16M4 19h16"
                    ></path>
                  </svg>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                    class="navigation-navigationtoggle-icon2 navigation__toggle-icon--close"
                  >
                    <path
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M6 6l12 12M6 18L18 6"
                    ></path>
                  </svg>
                </button>
                <div id="navigation-menu" class="navigation__menu">
                  <ul class="navigation__list">
                    <li class="navigation__item">
                      <a href="categories.html">
                        <div class="navigation__link"><span>Recycling Categories</span></div>
                      </a>
                    </li>
                    <li class="navigation__item">
                      <a href="index.html#locations">
                        <div class="navigation__link"><span>Find Nearby Locations</span></div>
                      </a>
                    </li>
                    <li class="navigation__item">
                      <a href="resources.html">
                        <div class="navigation__link"><span>Resource Links</span></div>
                      </a>
                    </li>
                    <li class="navigation__item">
                      <a href="index.html#about">
                        <div class="navigation__link"><span>Photo Recognition</span></div>
                      </a>
                    </li>
                    <li class="navigation__item navigation__item--cta">
                      <a href="index.html#search">
                        <div class="navigation__cta btn btn-primary"><span>AI Chatbot</span></div>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </nav>
            <div class="navigation-container2">
              <div class="navigation-container3">
                <style>
                  @media (prefers-reduced-motion: reduce) {
                    .navigation, .navigation__logo, .navigation__toggle, .navigation__link, .navigation__menu, .navigation__toggle-icon, .navigation__logo-icon {
                      transition: none;
                    }
                    .navigation__link::after { transition: none; }
                  }
                </style>
              </div>
            </div>
            <div class="navigation-container4">
              <div class="navigation-container5">
                <script defer data-name="navigation">
                  document.addEventListener('DOMContentLoaded', function() {
                    (function(){
                      const navigationToggle = document.getElementById("navigation-toggle");
                      const navigationMenu = document.getElementById("navigation-menu");
                      const navigation = document.getElementById("main-navigation");

                      if (navigationToggle && navigationMenu) {
                        navigationToggle.addEventListener("click", function () {
                          const isExpanded = navigationToggle.getAttribute("aria-expanded") === "true";
                          navigationToggle.setAttribute("aria-expanded", !isExpanded);
                          navigationMenu.classList.toggle("navigation__menu--open");
                          document.body.style.overflow = !isExpanded ? "hidden" : "";
                        });

                        // Backdrop click closes
                        navigationMenu.addEventListener("click", function (e) {
                          if (e.target === navigationMenu && navigationMenu.classList.contains("navigation__menu--open")) {
                            navigationToggle.setAttribute("aria-expanded", "false");
                            navigationMenu.classList.remove("navigation__menu--open");
                            document.body.style.overflow = "";
                          }
                        });

                        // Link click closes on mobile
                        const navigationLinks = navigationMenu.querySelectorAll(".navigation__link");
                        navigationLinks.forEach(function (link) {
                          link.addEventListener("click", function () {
                            if (window.innerWidth <= 991) {
                              navigationToggle.setAttribute("aria-expanded", "false");
                              navigationMenu.classList.remove("navigation__menu--open");
                              document.body.style.overflow = "";
                            }
                          });
                        });

                        // Reset on resize
                        let resizeTimer;
                        window.addEventListener("resize", function () {
                          clearTimeout(resizeTimer);
                          resizeTimer = setTimeout(function () {
                            if (window.innerWidth > 991) {
                              navigationToggle.setAttribute("aria-expanded", "false");
                              navigationMenu.classList.remove("navigation__menu--open");
                              document.body.style.overflow = "";
                            }
                          }, 250);
                        });
                      }

                      // Scroll enhancement
                      window.addEventListener("scroll", function () {
                        const currentScroll = window.pageYOffset;
                        if (currentScroll > 50) {
                          navigation.classList.add("navigation--scrolled");
                        } else {
                          navigation.classList.remove("navigation--scrolled");
                        }
                      });

                      // Escape closes
                      document.addEventListener("keydown", function (e) {
                        if (e.key === "Escape" && navigationMenu.classList.contains("navigation__menu--open")) {
                          navigationToggle.setAttribute("aria-expanded", "false");
                          navigationMenu.classList.remove("navigation__menu--open");
                          document.body.style.overflow = "";
                          navigationToggle.focus();
                        }
                      });
                    })();
                  });
                </script>
              </div>
            </div>
          </div>
        </navigation-wrapper>
      </div>
    </div>

    <main class="resources-section" style="max-width: var(--content-max-width);">
      <div class="resources-container">
        <section class="resources-content">
          <h1>County recycling resources</h1>
          <p class="lead">Enter your ZIP code to see official recycling guides for your county.</p>

          <form id="zip-form" class="lookup-form" style="margin: .25rem 0 0.5rem;">
            <label for="zip-input" class="sr-only">Enter ZIP code</label>
            <input
              id="zip-input"
              name="zip"
              inputmode="numeric"
              pattern="[0-9]{5}"
              maxlength="5"
              placeholder="Enter 5-digit ZIP (CA only)"
              aria-label="Enter 5-digit ZIP code"
            />
            <button type="submit" class="btn btn-outline btn-sm">Set ZIP</button>
            <span id="jurisdiction-badge" class="badge" style="display:none; color:#000;"></span>
            <button id="clear-jurisdiction" type="button" class="btn btn-link btn-sm" style="display:none;">Clear</button>
          </form>

          <div id="results" class="content-block">
            <h2>Resource links</h2>
            <ul id="resource-list" style="list-style: none; padding: 0; margin-top: .5rem;"></ul>
          </div>
        </section>

        <aside class="action-panel">
          <div class="card">
            <div class="card-header">
              <strong>Tips</strong>
            </div>
            <div class="card-body">
              <p>Your county site has the most accurate rules for diversion streams and special items.</p>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <script>
      (function() {
        const navigationToggle = document.getElementById("navigation-toggle");
        const navigationMenu = document.getElementById("navigation-menu");
        if (navigationToggle && navigationMenu) {
          navigationToggle.addEventListener("click", function () {
            const isExpanded = navigationToggle.getAttribute("aria-expanded") === "true";
            navigationToggle.setAttribute("aria-expanded", !isExpanded);
            navigationMenu.classList.toggle("navigation__menu--open");
            document.body.style.overflow = !isExpanded ? "hidden" : "";
          });
        }

        const ZIP_STORAGE_KEY = 'sortsmart.jurisdiction';
        const zipForm = document.getElementById('zip-form');
        const zipInput = document.getElementById('zip-input');
        const badge = document.getElementById('jurisdiction-badge');
        const clearBtn = document.getElementById('clear-jurisdiction');
        const list = document.getElementById('resource-list');

        function ensureCountySuffix(name) {
          if (!name) return name;
          const t = String(name).trim();
          return /\bcounty$/i.test(t) ? t : t + ' County';
        }
        function getStoredJurisdiction() {
          try { return JSON.parse(localStorage.getItem(ZIP_STORAGE_KEY) || 'null'); }
          catch { return null; }
        }
        function setStoredJurisdiction(obj) {
          localStorage.setItem(ZIP_STORAGE_KEY, JSON.stringify(obj));
        }
        function clearStoredJurisdiction() {
          localStorage.removeItem(ZIP_STORAGE_KEY);
        }
        function renderBadge(j) {
          const baseName = j && (j.county_name || j.jurisdiction_name);
          const name = baseName ? ensureCountySuffix(baseName) : null;
          if (name) {
            badge.style.display = '';
            clearBtn.style.display = '';
            badge.textContent = name + ' (' + (j.zip5 || '') + ')';
          } else {
            badge.style.display = 'none';
            clearBtn.style.display = 'none';
            badge.textContent = '';
          }
        }

        async function loadResourcesByZip(zip) {
          const res = await fetch('/api/resource_links?zip=' + encodeURIComponent(zip));
          if (!res.ok) {
            const err = await res.json().catch(() => ({}));
            throw new Error(err.error || 'Failed to load resources');
          }
          return res.json();
        }
        async function loadResourcesByCounty(j) {
          const name = ensureCountySuffix(j.county_name || j.jurisdiction_name);
          const res = await fetch('/api/resource_links?county_name=' + encodeURIComponent(name) + '&state=' + encodeURIComponent(j.state || 'CA'));
          if (!res.ok) throw new Error('Failed to load resources');
          return res.json();
        }
        function renderResources(rows) {
          list.innerHTML = '';
          if (!rows || !rows.length) {
            list.innerHTML = '<li style="padding:.5rem 0; color: var(--color-on-surface-secondary);">No resources found.</li>';
            return;
          }
          rows.forEach(r => {
            const li = document.createElement('li');
            li.style.padding = '.5rem 0';
            li.style.borderBottom = '1px solid var(--color-border)';
            const title = r[1] || r.title;
            const url = r[2] || r.url;
            li.innerHTML = `<a href="${url}" target="_blank" rel="noopener" class="link">${title}</a>`;
            list.appendChild(li);
          });
        }

        // Init from saved county
        const initJ = getStoredJurisdiction();
        if (initJ) {
          renderBadge(initJ);
          loadResourcesByCounty(initJ).then(renderResources).catch(() => renderResources([]));
        }

        // ZIP submit
        zipForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const zip = (zipInput.value || '').trim();
          if (!/^[0-9]{5}$/.test(zip)) {
            alert('Please enter a valid 5-digit ZIP.');
            return;
          }
          try {
            // Resolve and store county/state
            const zr = await fetch('/api/zip_lookup?zip=' + encodeURIComponent(zip));
            if (!zr.ok) {
              const err = await zr.json().catch(() => ({}));
              throw new Error(err.error || 'ZIP not found');
            }
            const j = await zr.json();
            if (j.county_name) j.county_name = ensureCountySuffix(j.county_name);
            if (j.jurisdiction_name) j.jurisdiction_name = ensureCountySuffix(j.jurisdiction_name);
            setStoredJurisdiction(j);
            renderBadge(j);

            // Load resources
            const data = await loadResourcesByZip(zip);
            renderResources(data);
          } catch (err) {
            alert(err.message || 'Failed to look up ZIP.');
          }
        });

        clearBtn.addEventListener('click', () => {
          clearStoredJurisdiction();
          renderBadge(null);
          list.innerHTML = '<li style="padding:.5rem 0; color: var(--color-on-surface-secondary);">Enter a ZIP to see resources.</li>';
        });
      })();
    </script>
  </body>
</html>