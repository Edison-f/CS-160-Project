<!DOCTYPE html>
<html lang="en">
  <head>
    <title>AI Chatbot â€” SortSmart</title>
    <meta property="og:title" content="AI Chatbot â€” SortSmart" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./style.css" />
    <link href="./index.css" rel="stylesheet" />
    <style>
      .home-container1 {
        min-height: auto;
      }
      .chatbot-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        height: calc(100vh - 200px);
      }
      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background: var(--color-surface-secondary, #f9f9f9);
        border-radius: 8px;
        margin-bottom: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .message {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        max-width: 80%;
        word-wrap: break-word;
      }
      .message.user {
        align-self: flex-end;
        background: var(--color-primary, #007bff);
        color: white;
      }
      .message.bot {
        align-self: flex-start;
        background: white;
        border: 1px solid var(--color-border, #ddd);
      }
      .chat-input-container {
        display: flex;
        gap: 0.5rem;
      }
      .chat-input {
        flex: 1;
        padding: 0.75rem;
        border: 1px solid var(--color-border, #ddd);
        border-radius: 4px;
        font-size: 1rem;
      }
      .chat-input:focus {
        outline: none;
        border-color: var(--color-primary, #007bff);
      }
      .send-btn {
        padding: 0.75rem 1.5rem;
      }
      .loading-indicator {
        padding: 0.75rem 1rem;
        background: white;
        border: 1px solid var(--color-border, #ddd);
        border-radius: 8px;
        align-self: flex-start;
        max-width: 80%;
        color: #666;
      }
      .error-message {
        padding: 0.75rem 1rem;
        background: #f8d7da;
        color: #721c24;
        border-radius: 8px;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <div>
      <div class="home-container1">
        <navigation-wrapper class="navigation-wrapper">
          <div class="navigation-container1">
            <nav id="main-navigation" aria-label="Main navigation" class="navigation">
              <div class="navigation__container">
                <a href="index.html">
                  <div aria-label="SortSmart - Home" class="navigation__logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" aria-hidden="true" class="navigation__logo-icon">
                      <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                        <path d="M7 19H4.815a1.83 1.83 0 0 1-1.57-.881a1.79 1.79 0 0 1-.004-1.784L7.196 9.5M11 19h8.203a1.83 1.83 0 0 0 1.556-.89a1.78 1.78 0 0 0 0-1.775l-1.226-2.12"></path>
                        <path d="m14 16l-3 3l3 3m-5.707-8.404L7.196 9.5L3.1 10.598m6.244-4.787l1.093-1.892A1.83 1.83 0 0 1 11.985 3a1.78 1.78 0 0 1 1.546.888l3.943 6.843"></path>
                        <path d="m13.378 9.633l4.096 1.098l1.097-4.096"></path>
                      </g>
                    </svg>
                    <span class="navigation__logo-text">SortSmart</span>
                  </div>
                </a>
                <button id="navigation-toggle" aria-expanded="false" aria-controls="navigation-menu" aria-label="Toggle navigation menu" class="navigation__toggle">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" class="navigation-navigationtoggle-icon1 navigation__toggle-icon--open">
                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5h16M4 12h16M4 19h16"></path>
                  </svg>
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" class="navigation-navigationtoggle-icon2 navigation__toggle-icon--close">
                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6l12 12M6 18L18 6"></path>
                  </svg>
                </button>
                <div id="navigation-menu" class="navigation__menu">
                  <ul class="navigation__list">
                    <li class="navigation__item"><a href="categories.html"><div class="navigation__link"><span>Recycling Categories</span></div></a></li>
                    <li class="navigation__item"><a href="index.html#locations"><div class="navigation__link"><span>Find Nearby Locations</span></div></a></li>
                    <li class="navigation__item"><a href="resources.html"><div class="navigation__link"><span>Resource Links</span></div></a></li>
                    <li class="navigation__item"><a href="photo-recognition.html"><div class="navigation__link"><span>Photo Recognition</span></div></a></li>
                    <li class="navigation__item navigation__item--cta"><a href="chatbot.html"><div class="navigation__cta btn btn-primary"><span>AI Chatbot</span></div></a></li>
                  </ul>
                </div>
              </div>
            </nav>
            <div class="navigation-container2"><div class="navigation-container3"></div></div>
            <div class="navigation-container4">
              <div class="navigation-container5">
                <script defer data-name="navigation">
                  document.addEventListener('DOMContentLoaded', function() {
                    (function(){
                      const navigationToggle = document.getElementById("navigation-toggle");
                      const navigationMenu = document.getElementById("navigation-menu");
                      if (navigationToggle && navigationMenu) {
                        navigationToggle.addEventListener("click", function () {
                          const isExpanded = navigationToggle.getAttribute("aria-expanded") === "true";
                          navigationToggle.setAttribute("aria-expanded", !isExpanded);
                          navigationMenu.classList.toggle("navigation__menu--open");
                          document.body.style.overflow = !isExpanded ? "hidden" : "";
                        });
                      }
                    })();
                  });
                </script>
              </div>
            </div>
          </div>
        </navigation-wrapper>
        
        <div class="chatbot-container">
          <h1>AI Recycling Assistant</h1>
          <p>Ask me anything about recycling, composting, or waste disposal!</p>
          
          <div id="error-container"></div>
          
          <div class="chat-messages" id="chat-messages">
            <div class="message bot">
              ðŸ‘‹ Hi! I'm your recycling assistant. Ask me questions like:
              <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                <li>"How do I recycle plastic bottles?"</li>
                <li>"Can I compost coffee grounds?"</li>
                <li>"What goes in the blue bin?"</li>
              </ul>
            </div>
          </div>
          
          <div class="chat-input-container">
            <input type="text" id="chat-input" class="chat-input" placeholder="Type your question here..." autocomplete="off">
            <button id="send-btn" class="btn btn-primary send-btn">Send</button>
          </div>
        </div>
      </div>
    </div>
    
    <script>
      (function() {
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const errorContainer = document.getElementById('error-container');
        
        function addMessage(text, isUser) {
          const messageDiv = document.createElement('div');
          messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
          messageDiv.textContent = text;
          chatMessages.appendChild(messageDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function showLoading() {
          const loadingDiv = document.createElement('div');
          loadingDiv.className = 'loading-indicator';
          loadingDiv.id = 'loading-indicator';
          loadingDiv.textContent = 'Thinking...';
          chatMessages.appendChild(loadingDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function hideLoading() {
          const loading = document.getElementById('loading-indicator');
          if (loading) loading.remove();
        }
        
        function showError(message) {
          errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
        }
        
        function hideError() {
          errorContainer.innerHTML = '';
        }
        
        async function sendMessage() {
          const message = chatInput.value.trim();
          if (!message) return;
          
          // Add user message
          addMessage(message, true);
          chatInput.value = '';
          hideError();
          showLoading();
          
          try {
            const response = await fetch('/api/chatbot', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ message })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
              throw new Error(data.error || 'Failed to get response');
            }
            
            if (data.response) {
              addMessage(data.response, false);
            } else {
              throw new Error('No response received');
            }
          } catch (err) {
            hideLoading();
            showError(err.message || 'Failed to send message. Please try again.');
            addMessage('Sorry, I encountered an error. Please try again.', false);
          } finally {
            hideLoading();
          }
        }
        
        sendBtn.addEventListener('click', sendMessage);
        
        chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            sendMessage();
          }
        });
      })();
    </script>
  </body>
</html>

